<div class="checklist-section">
  <div class="section-header">
    <h2>Mi Checklist</h2>
    <div class="header-buttons">
      <app-button
        type="secondary"
        text="Inicio"
        iconLeft="home"
        (clickEvent)="goHome()"
      >
      </app-button>
      <app-button
        type="secondary"
        text="{{ getSaveButtonText() }}"
        iconLeft="save"
        [title]="getSaveButtonTooltip()"
        (clickEvent)="saveProgress()"
      >
      </app-button>
      <app-button
        type="secondary"
        text="Editar Lista"
        iconLeft="edit"
        (clickEvent)="editMode()"
      >
      </app-button>
      <app-button
        type="primary"
        text="Nueva Lista"
        iconLeft="add_circle_outline"
        (clickEvent)="confirmStartNewList()"
      >
      </app-button>
    </div>
  </div>

  <!-- Indicador de progreso -->
  @if (currentList) {
  <div class="progress-section">
    <div class="progress-text">
      Progreso: {{ progress.completed }} de {{ progress.total }} tareas
      completadas
    </div>
    <div class="progress-indicator">
      <div class="progress-bar" [style.width.%]="progress.percentage"></div>
    </div>
  </div>
  }

  <!-- Contenedor de tareas -->
  @if (currentList) {
  <div class="tasks-container">
    @for (task of currentList.tasks; track trackByTaskId($index, task)) {
    <app-task-item
      [task]="task"
      (taskToggled)="onTaskToggled($event)"
      (subtaskToggled)="onSubtaskToggled($event)"
      (subtaskAdded)="onSubtaskAdded($event)"
      (subtaskRemoved)="onSubtaskRemoved($event)"
      (subtaskUpdated)="onSubtaskUpdated($event)"
      (errorAdded)="onErrorAdded($event)"
      (errorRemoved)="onErrorRemoved($event)"
      (errorUpdated)="onErrorUpdated($event)"
      (taskUpdated)="onTaskUpdated($event)"
      (taskDeleted)="onTaskDeleted($event)"
      (taskExported)="onTaskExported($event)"
    >
    </app-task-item>
    }
  </div>
  }

  <!-- Sección de observaciones -->
  @if (currentList) {
  <div class="observations-section">
    <app-input
      inputId="observations"
      label="Observaciones del día:"
      placeholder="Notas adicionales, comentarios importantes..."
      [isTextarea]="true"
      [rows]="4"
      [(value)]="currentList.observations"
      (valueChange)="onObservationsChange()"
      size="md"
      variant="default"
    ></app-input>
  </div>
  }

  <!-- Acciones -->
  @if (currentList) {
  <div class="actions">
    <app-button
      type="outline-secondary"
      text="Exportar PDF"
      iconLeft="file_download"
      size="md"
      (clickEvent)="exportToPDF()"
    >
    </app-button>
    <app-button
      type="outline-secondary"
      text="Exportar TXT"
      iconLeft="description"
      size="md"
      (clickEvent)="exportToTXT()"
    >
    </app-button>
  </div>
  }

  <!-- Modal para editar lista -->
  <app-modal
    [isVisible]="(showEditModal$ | async) ?? false"
    [data]="editModalData$ | async"
    (confirmed)="onEditConfirm($event)"
    (closed)="closeEditModal()"
  >
  </app-modal>

  <!-- Modal para guardar -->
  <app-modal
    [isVisible]="(showSaveModal$ | async) ?? false"
    [data]="saveModalData$ | async"
    (confirmed)="onSaveConfirm($event)"
    (closed)="closeSaveModal()"
  >
  </app-modal>

  <!-- Modal de confirmación para tareas -->
  <app-confirm-modal
    [isVisible]="(taskShowConfirmModal$ | async) ?? false"
    [data]="taskConfirmModalData$ | async"
    (confirmed)="confirmTaskDeletion()"
    (cancelled)="cancelTaskDeletion()"
  >
  </app-confirm-modal>

  <!-- Modal de confirmación para navegación -->
  <app-confirm-modal
    [isVisible]="(navigationShowConfirmModal$ | async) ?? false"
    [data]="navigationConfirmModalData$ | async"
    (confirmed)="onConfirmAction()"
    (cancelled)="onCancelAction()"
  >
  </app-confirm-modal>

  <!-- Modal de alerta -->
  <app-alert-modal
    [isVisible]="(showAlertModal$ | async) ?? false"
    [data]="alertModalData$ | async"
    (closed)="closeAlert()"
  >
  </app-alert-modal>
</div>
